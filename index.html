<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Photo Resizer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="number"],
    input[type="file"] {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
    #resizeBtn, #downloadBtn {
      margin: 20px auto;
      display: block;
      padding: 10px 20px;
      font-size: 16px;
    }
    #downloadBtn {
      display: none;
    }
    .note {
      font-size: 0.9em;
      color: #555;
      text-align: center;
      margin-top: -10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Custom Photo Resizer</h1>
  <p class="note">
    Fill in the fields below. Either provide width and height ranges (columns 3 & 4) or an exact dimension (column 5).<br>
    The "Resize" button will activate once required fields are completed.
  </p>
  <div class="container">
    <!-- Column 1: Image Upload -->
    <div class="form-group">
      <label for="imageUpload">Upload Image</label>
      <input type="file" id="imageUpload" accept="image/*" />
    </div>
    <!-- Column 2: File Size Limits -->
    <div class="form-group">
      <label for="minSize">Min File Size (KB)</label>
      <input type="number" id="minSize" placeholder="e.g., 20" />
      <label for="maxSize">Max File Size (KB)</label>
      <input type="number" id="maxSize" placeholder="e.g., 100" />
    </div>
    <!-- Column 3: Width Range -->
    <div class="form-group">
      <label for="minWidth">Min Width (px)</label>
      <input type="number" id="minWidth" placeholder="e.g., 300" />
      <label for="maxWidth">Max Width (px)</label>
      <input type="number" id="maxWidth" placeholder="e.g., 600" />
    </div>
    <!-- Column 4: Height Range -->
    <div class="form-group">
      <label for="minHeight">Min Height (px)</label>
      <input type="number" id="minHeight" placeholder="e.g., 300" />
      <label for="maxHeight">Max Height (px)</label>
      <input type="number" id="maxHeight" placeholder="e.g., 600" />
    </div>
    <!-- Column 5: Exact Dimensions (Optional) -->
    <div class="form-group">
      <label for="dimensions">Exact Dimensions (inches @ dpi)</label>
      <input type="text" id="dimensions" placeholder="e.g., 2x2 @300" />
    </div>
  </div>
  <!-- Resize Button -->
  <button id="resizeBtn" disabled>Resize</button>
  <!-- Download Button (appears after resize) -->
  <button id="downloadBtn">Download Resized Image</button>
  
  <!-- Hidden Canvas to Process the Image -->
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
    // Get form elements
    const imageUpload = document.getElementById('imageUpload');
    const minSize = document.getElementById('minSize');
    const maxSize = document.getElementById('maxSize');
    const minWidth = document.getElementById('minWidth');
    const maxWidth = document.getElementById('maxWidth');
    const minHeight = document.getElementById('minHeight');
    const maxHeight = document.getElementById('maxHeight');
    const dimensions = document.getElementById('dimensions');
    const resizeBtn = document.getElementById('resizeBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const canvas = document.getElementById('canvas');

    let resizedImageDataURL = '';

    // Function to check if required fields are filled
    function validateInputs() {
      // Check that an image file is uploaded
      if (!imageUpload.files || imageUpload.files.length === 0) {
        return false;
      }
      // Check file size limits are provided
      if (!minSize.value || !maxSize.value) {
        return false;
      }
      // Ensure either width/height range OR exact dimensions is provided
      const rangeProvided = minWidth.value && maxWidth.value && minHeight.value && maxHeight.value;
      const exactProvided = dimensions.value;
      if (!rangeProvided && !exactProvided) {
        return false;
      }
      return true;
    }

    // Enable or disable the Resize button based on input validation
    function updateResizeButton() {
      resizeBtn.disabled = !validateInputs();
    }

    // Add event listeners to all inputs for real-time validation
    [imageUpload, minSize, maxSize, minWidth, maxWidth, minHeight, maxHeight, dimensions].forEach(input => {
      input.addEventListener('input', updateResizeButton);
    });

    // Resize button click event
    resizeBtn.addEventListener('click', function () {
      if (!validateInputs()) {
        alert('Please fill in all required fields.');
        return;
      }
      // Read the uploaded image file
      const file = imageUpload.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          let newWidth, newHeight;
          if (dimensions.value) {
            // If exact dimensions are provided, parse them.
            // Expected format: "widthxheight @dpi" (e.g., "2x2 @300")
            const parts = dimensions.value.split('@');
            if (parts.length === 2) {
              const dims = parts[0].trim().split('x');
              if (dims.length === 2) {
                // Convert inches to pixels using the provided DPI
                const dpi = parseInt(parts[1].trim());
                const inchesWidth = parseFloat(dims[0]);
                const inchesHeight = parseFloat(dims[1]);
                newWidth = Math.round(inchesWidth * dpi);
                newHeight = Math.round(inchesHeight * dpi);
              }
            }
          } else {
            // Otherwise, use the minimum values as the new dimensions.
            newWidth = parseInt(minWidth.value);
            newHeight = parseInt(minHeight.value);
          }
          // Set canvas size and draw the image
          canvas.width = newWidth;
          canvas.height = newHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, newWidth, newHeight);
          // Get the new image data (as JPEG format)
          resizedImageDataURL = canvas.toDataURL('image/jpeg');
          // Show the Download button
          downloadBtn.style.display = 'block';
          alert('Image resized successfully! Click the download button to save it.');
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    // Download button click event
    downloadBtn.addEventListener('click', function () {
      if (!resizedImageDataURL) return;
      const link = document.createElement('a');
      link.href = resizedImageDataURL;
      link.download = 'resized-image.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  </script>
</body>
</html>
